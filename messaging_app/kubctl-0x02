#!/usr/bin/bash

set -euo pipefail

echo "ğŸš€ Deploying BLUE version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸ“¦ Waiting for BLUE pods..."
kubectl rollout status deployment/messaging-app-blue

echo "ğŸš€ Deploying GREEN version..."
kubectl apply -f green_deployment.yaml

echo "ğŸ“¦ Waiting for GREEN pods..."
kubectl rollout status deployment/messaging-app-green

echo "ğŸ§ª Checking logs of GREEN deployment for errors..."
kubectl logs deployment/messaging-app-green --tail=20

echo "ğŸ” Switching service traffic to GREEN..."
kubectl apply -f kubeservice.yaml

echo "âœ… Blue-Green deployment completed successfully."
